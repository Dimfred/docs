---
sidebar_position: 10
title: Work with Transaction
sidebar_label: Work with Transaction
---

## Unsigned Transaction Structure

An unsigned transaction contains the following elements:

* `version`: This field specifies the version of the transaction format being used. This allows the network to handle different formats as the protocol evolves
* `networkId`: This field identifies the specific network the transaction is intended for. This ensures that the transaction is processed on the correct network
* `scriptOpt`: This optional field contains the script code to be executed as part of the transaction. This is used for transactions involving smart contracts
* `gasAmount`: This field specifies the amount of gas that the transaction can consume
* `gasPrice`: This field indicates the price per unit of gas that the sender is willing to pay. This determines the total transaction fee and can affect the transaction's priority in the network
* `inputs`: This field lists the sources of funds for the transaction. Each input typically references a previous transaction output
* `fixedOutputs`: This field defines the recipients and amounts of the transaction. Each output specifies an address and the amount of funds being sent to that address

## Signed Transaction Structure

Unsigned transactions can only be submitted to the Alephium network after being signed. A signed transaction contains the following elements:

* `unsigned`: The unsigned transaction
* `scriptExecutionOk`: This field indicates whether the transaction script is executed successfully
* `contractInputs`: This field contains all the contract assets required for executing the transaction
* `generatedOutputs`: This field contains all outputs generated by the contract
* `inputSignatures`: This field contains the signatures for the inputs used in the transaction
* `scriptSignatures`: This field contains the signatures that are used during the script execution

## Transaction Builder

In Alephium, you can first build unsigned transactions, then sign the unsigned transactions, and finally submit the signed transactions to the network. The `TransactionBuilder` is used to build unsigned transactions.

It needs your address and public key to build the transaction. If you have a private key, you can obtain the public key using the following method:

```typescript
import { publicKeyFromPrivateKey } from '@alephium/web3'

const publicKey = publicKeyFromPrivateKey('your-private-key')
```

You can also export the public key from your [extension wallet](/wallet/extension-wallet/getting-started#edit-account) or [desktop wallet](/wallet/desktop-wallet/getting-started.md#5-export-public-key-and-private-key).

### Building Transfer Transactions

```typescript
import { TransactionBuilder } from '@alephium/web3'

const nodeUrl = 'http://127.0.0.1:22973'
const builder = TransactionBuilder.from(nodeUrl)
const senderAddress = '1DrDyTr9RpRsQnDnXo2YRiPzPW4ooHX5LLoqXrqfMrpQH'
const publicKey = '0381818e63bd9e35a5489b52a430accefc608fd60aa2c7c0d1b393b5239aedf6b0'
const result = await builder.buildTransferTx(
  {
    signerAddress: senderAddress,
    destinations: [{
      address: '1FsroWmeJPBhcPiUr37pWXdojRBe6jdey9uukEXk1TheA' // the receiver address
      attoAlphAmount: ONE_ALPH
    }]
  },
  publicKey
)
const unsignedTx = result.unsignedTx
```

### Building Deploy Contract Transactions

```typescript
const senderAddress = '1DrDyTr9RpRsQnDnXo2YRiPzPW4ooHX5LLoqXrqfMrpQH'
const publicKey = '0381818e63bd9e35a5489b52a430accefc608fd60aa2c7c0d1b393b5239aedf6b0'
// you can get the bytecode using `Contract.buildByteCodeToDeploy`
const bytecode = '00010b010000000001d38d0b36360000'
const result = await builder.buildDeployContractTx(
  {
    signerAddress: senderAddress,
    bytecode
  },
  publicKey
)
const unsignedTx = result.unsignedTx
```

### Building Execute Script Transactions

```typescript
const senderAddress = '1DrDyTr9RpRsQnDnXo2YRiPzPW4ooHX5LLoqXrqfMrpQH'
const publicKey = '0381818e63bd9e35a5489b52a430accefc608fd60aa2c7c0d1b393b5239aedf6b0'
// you can get the bytecode using `Script.buildByteCodeToDeploy`
const bytecode = '010103000000040c0c1440205f3a18d50689521ddc9eec9472976c5495301169ae2d21af662e0836fb87f6ff0100'
const result = await builder.buildExecuteScriptTx(
  {
    signerAddress: account.address,
    bytecode
  },
  account.publicKey
)
const unsignedTx = result.unsignedTx
```

You can use the `SignerProvider` to sign and submit transactions, you can refer to the documentation [here](./signer-provider.md#usage-of-signerprovider) for more details.

## Query Transaction Status

```typescript
import { NodeProvider } from '@alephium/web3'

const nodeUrl = 'http://127.0.0.1:12973'
const nodeProvider = new NodeProvider(nodeUrl)

const txId = '919d4e4b1080d74beb56a1f78ea7c0569a358e3ea3988058987cc1addf4b93cc'
const txStatus = await nodeProvider.transactions.getTransactionsStatus({ txId })
```

You can differentiate the transaction status using the `txStatus.type`:

1. `MemPooled`: this means the transaction is in the mempool
2. `Confirmed`: the transaction has been confirmed, and you can get the number of confirmations using `txStatus.chainConfirmations`
3. `TxNotFound`: the transaction does not exist

## Get Transaction Details

```typescript
const details = await nodeProvider.transactions.getTransactionsDetailsTxid(txId)
```

For transfer transactions, you can obtain the transaction details if the transaction is successful. For script tx, you need to check `scriptExecutionOk` to determine if the transaction is executed successfully:

```typescript
if (details.unsigned.scriptOpt !== undefined && !details.scriptExecutionOk) {
  // the script transaction failed
}
```

## Decode Unsigned Transaction

```typescript
const nodeProvider = new NodeProvider('http://127.0.0.1:22973')
const decodedTx = await nodeProvider.transactions.postTransactionsDecodeUnsignedTx({ unsignedTx })
```

You can also use the `codec` to decode unsigned transaction, you can refer to the documentation [here](./codec.md) for more details.
